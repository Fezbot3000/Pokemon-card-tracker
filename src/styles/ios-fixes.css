/* Modal height fix for full-screen modals only */
.modal-container:not(.modal-contextual) {
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height for better compatibility */
}

/* Contextual modals should have auto height */
.modal-container.modal-contextual {
  height: auto;
  max-height: 90vh;
}

  /* iOS Safari specific fixes using design tokens */
@supports (-webkit-touch-callout: none) {
  /* Fix logged-out navigation bar positioning on iOS */
  div.ios-safe-nav.fixed.top-0 {
    padding-top: calc(var(--space-4) + var(--safe-area-top));
  }

  /* Fix logged-in header positioning on iOS */
  header.fixed.top-0 {
    top: var(--safe-area-top);
  }

  /* iOS Safari modal fixes */
  .modal-footer-ios-fix {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: var(--z-index-modal);
  }

  .modal-content-with-absolute-footer {
    padding-bottom: var(--space-20); /* Account for absolute footer */
  }

  /* Fix horizontal scrolling in modals on iPad PWA */
  @media (display-mode: standalone) {
    .modal-container {
      overflow-x: hidden;
    }

    .modal-container * {
      max-width: 100%;
      box-sizing: border-box;
    }

    /* PWA-specific checkbox optimization using design tokens */
    body.pwa input[type='checkbox'],
    body.pwa button[aria-label*='Select'],
    body.pwa button[aria-label*='Deselect'],
    .checkbox-pwa {
      width: var(--pwa-checkbox-size);
      height: var(--pwa-checkbox-size);
      min-width: var(--pwa-checkbox-min-size);
      min-height: var(--pwa-checkbox-min-size);
      max-width: var(--pwa-checkbox-size);
      max-height: var(--pwa-checkbox-size);
      transform: scale(0.8);
    }

    /* Card selection buttons optimization */
    body.pwa .absolute.top-2.right-2 button,
    body.pwa .absolute.top-2.right-2 input {
      width: var(--pwa-checkbox-size);
      height: var(--pwa-checkbox-size);
    }
  }

  /* iOS PWA modal header safe area using design tokens */
  @media (display-mode: standalone) {
    .modal-header-ios-safe {
      padding-top: calc(var(--space-3) + var(--safe-area-top));
    }
  }

  /* Improved scroll behavior on iOS */
  .modal-body {
    -webkit-overflow-scrolling: touch;
    overflow-y: auto;
  }

  /* iOS PWA specific fixes using design tokens */
  @media (display-mode: standalone) {
    /* PWA safe area handling */
    .modal-container {
      padding-top: var(--safe-area-top);
      padding-bottom: var(--safe-area-bottom);
    }
  }

  /* iOS form input zoom prevention using design tokens */
  input[type='text'],
  input[type='email'],
  input[type='password'],
  input[type='number'],
  textarea,
  select {
    font-size: var(--font-size-base); /* Prevent zoom on iOS */
  }

  /* iOS button tap targets using design tokens */
  .btn,
  button,
  .button,
  .touch-target-pwa {
    min-height: var(--pwa-touch-target-min);
    min-width: var(--pwa-touch-target-min);
  }

  /* Mobile specific navigation fixes using design tokens */
  @media (max-width: 640px) {
    div.ios-safe-nav.fixed.top-0 {
      padding-top: calc(var(--space-2) + var(--safe-area-top));
    }

    .modal-container:not(.modal-contextual) {
      height: 100vh;
      height: 100dvh;
      margin: var(--space-0);
      padding: var(--space-0);
    }

    /* Contextual modals stay contextual even on mobile */
    .modal-container.modal-contextual {
      height: auto;
      max-height: 80vh;
      margin: var(--space-8);
    }
  }

  /* Tablet navigation fixes using design tokens */
  @media (min-width: 641px) and (max-width: 768px) {
    div.ios-safe-nav.fixed.top-0 {
      padding-top: calc(var(--space-3) + var(--safe-area-top));
    }
  }

  /* iPad PWA specific fixes using design tokens and proper specificity */
  @media (min-width: 768px) and (max-width: 1024px) and (display-mode: standalone) {
    /* Fix search toolbar alignment on iPad PWA */
    body.pwa .search-toolbar {
      align-items: center;
    }

    /* Fix filter button positioning */
    body.pwa .search-toolbar button,
    body.pwa .search-toolbar .dropdown-trigger {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Fix view selector alignment */
    body.pwa .search-toolbar .view-selector {
      align-items: center;
    }

    /* Ensure proper button heights using design tokens */
    body.pwa .search-toolbar button {
      min-height: var(--space-10);
    }
  }

  /* PWA mode navigation fixes using design tokens */
  @media (display-mode: standalone) {
    div.ios-safe-nav.fixed.top-0 {
      padding-top: calc(var(--space-4) + var(--safe-area-top));
    }

    /* Desktop PWA header background fill - handled by unified design system */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--safe-area-top);
      background-color: var(--bg-primary);
      z-index: var(--z-index-header);
    }
  }
}
