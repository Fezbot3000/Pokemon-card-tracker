<!DOCTYPE html>
<html>
<head>
  <title>Firebase Storage CORS Fix</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { padding: 10px; margin: 10px 0; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Firebase Storage CORS Fix</h1>
  
  <div>
    <h2>Step 1: Test Current CORS Settings</h2>
    <button id="testCors">Test CORS Configuration</button>
    <div id="corsResult"></div>
  </div>

  <div>
    <h2>Step 2: Apply CORS Fix</h2>
    <p>This will create a temporary file in your Firebase Storage bucket with proper CORS headers.</p>
    <button id="applyCors">Apply CORS Fix</button>
    <div id="applyResult"></div>
  </div>

  <script>
    // Test if CORS is properly configured
    document.getElementById('testCors').addEventListener('click', async () => {
      const resultDiv = document.getElementById('corsResult');
      resultDiv.innerHTML = 'Testing CORS configuration...';
      
      try {
        // Try to make an OPTIONS request to the Firebase Storage bucket
        const response = await fetch('https://firebasestorage.googleapis.com/v0/b/mycardtracker-c8479.firebaseapp.com/o', {
          method: 'OPTIONS',
          headers: {
            'Origin': window.location.origin,
            'Access-Control-Request-Method': 'POST',
            'Access-Control-Request-Headers': 'Content-Type'
          }
        });
        
        if (response.ok) {
          resultDiv.innerHTML = '<p class="success">CORS is correctly configured!</p>';
        } else {
          resultDiv.innerHTML = `<p class="error">CORS is not correctly configured. Status: ${response.status}</p>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<p class="error">Error testing CORS: ${error.message}</p>`;
      }
    });

    // Apply a direct CORS fix
    document.getElementById('applyCors').addEventListener('click', async () => {
      const resultDiv = document.getElementById('applyResult');
      resultDiv.innerHTML = 'Applying CORS fix...';
      
      // Create a simple form with a file
      const formData = new FormData();
      const blob = new Blob(['CORS test file'], { type: 'text/plain' });
      formData.append('file', blob, 'cors-test.txt');
      
      try {
        // Try direct upload with all possible headers
        const response = await fetch('https://firebasestorage.googleapis.com/v0/b/mycardtracker-c8479.firebaseapp.com/o?name=cors-test.txt', {
          method: 'POST',
          body: formData,
          headers: {
            // Include all possible headers that might help
            'Origin': window.location.origin
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          resultDiv.innerHTML = `
            <p class="success">CORS fix applied successfully!</p>
            <p>File uploaded to Firebase Storage.</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        } else {
          resultDiv.innerHTML = `
            <p class="error">Failed to apply CORS fix. Status: ${response.status}</p>
            <p>Try the alternative approach below:</p>
            <pre>
1. Go to Firebase Console > Storage
2. Create a new file manually
3. Set its metadata to include CORS headers
            </pre>
          `;
        }
      } catch (error) {
        resultDiv.innerHTML = `
          <p class="error">Error applying CORS fix: ${error.message}</p>
          <p>Let's try a different approach. Let's modify the code to use a different upload method.</p>
        `;
      }
    });
  </script>
</body>
</html>
